"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),PromisedList=function(){function PromisedList(list){_classCallCheck(this,PromisedList),this.__list__=list}return _createClass(PromisedList,[{key:"__each__",value:function(callback){var _this=this;return new Promise(function(resolve,reject){var iter=_this[Symbol.iterator](),i=0,result=iter.next(),returnValues=[],wrapper=function wrapper(item){var stopped=!1;Promise.resolve(callback({item:item,index:i,stop:function(){stopped=!0}})).then(function(value){returnValues.push(value),stopped?Promise.all(returnValues).then(resolve,reject):(i+=1,result=iter.next(),result.done?Promise.all(returnValues).then(resolve,reject):result.value.then(wrapper))},reject)};result.done?resolve(returnValues):result.value.then(wrapper)})}},{key:"pop",value:function(){var result=this.at(this.length-1);return this.__list__.pop(),result}},{key:"push",value:function(){var _list__;return(_list__=this.__list__).push.apply(_list__,arguments),this.length}},{key:"shift",value:function(){var result=this.at(0);return this.__list__.shift(),result}},{key:"unshift",value:function(){var _list__2;return(_list__2=this.__list__).unshift.apply(_list__2,arguments),this.length}},{key:"toArray",value:function(){return this.__each__(function(obj){return obj.item})}},{key:"each",value:function(callback){return this.__each__(function(obj){return Promise.resolve(callback(obj.item,obj.index)).then(function(answer){answer===!1&&obj.stop()})}).then(function(){})}},{key:"map",value:function(callback){return this.__each__(function(obj){return callback(obj.item,obj.index)})}},{key:"pluck",value:function(key){return this.__each__(function(obj){return obj.item.hasRel(key)?obj.item.getRel(key):obj.item.get(key)})}},{key:"reduce",value:function(callback,initial){var memo=initial;return this.__each__(function(obj){return Promise.resolve(callback(memo,obj.item,obj.index)).then(function(result){memo=result})}).then(function(){return memo})}},{key:"find",value:function(callback){var result=void 0;return this.__each__(function(obj){return Promise.resolve(callback(obj.item,obj.index)).then(function(answer){answer===!0&&(result=obj.item,obj.stop())})}).then(function(){return result})}},{key:"filter",value:function(callback){var results=[];return this.__each__(function(obj){return Promise.resolve(callback(obj.item,obj.index)).then(function(answer){answer===!0&&results.push(obj.item)})}).then(function(){return results})}},{key:"reject",value:function(callback){var results=[];return this.__each__(function(obj){return Promise.resolve(callback(obj.item,obj.index)).then(function(answer){answer===!1&&results.push(obj.item)})}).then(function(){return results})}},{key:"all",value:function(callback){var result=!0;return this.__each__(function(obj){return Promise.resolve(callback(obj.item,obj.index)).then(function(answer){answer===!1&&(result=!1,obj.stop())})}).then(function(){return result})}},{key:"any",value:function(callback){var result=!1;return this.__each__(function(obj){return Promise.resolve(callback(obj.item,obj.index)).then(function(answer){answer===!0&&(result=!0,obj.stop())})}).then(function(){return result})}},{key:"at",value:function(n){return Promise.resolve(this.__list__[n])}},{key:Symbol.iterator,value:function(){var i=0,self=this;return{next:function(){if(i===self.length)return{done:!0};var value=self.at(i);return i+=1,{done:!1,value:value}}}}},{key:"length",get:function(){return this.__list__.length}}]),PromisedList}();exports["default"]=PromisedList;